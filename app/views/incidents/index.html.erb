<div>
  <span style="display: inline-block">
    <h2 class="title is-4">Incidents</h2>
  </span>
  <span>
    <a href="<%= new_incident_path %>" class="button is-link" style="float: right">New Incident</a>
  </span>
</div>

<br>

<% if @incidents.empty? %>
  No incidents
  <br />
<% else %>
  <table class="incidents-table hover stripe">
    <thead>
      <tr>
        <th>Name</th>
        <th>Status</th>
        <th>Created At</th>
        <th>Created By</th>
        <th>Tags</th>
        <th>Total Tickets</th>
        <th>Leads</th>
        <th>Show</th>
        <th>Tree</th>
      </tr>
    </thead>

    <tbody>
      <% @incidents.each do |incident| %>
        <tr>
          <td><%= incident.name %></td>
          <td>
            <% if incident.status == "closed"%>
                <span class="tag is-success">Closed</span>
            <% elsif incident.status == "in_progress" %>
                <span class="tag is-warning">In Progress</span>
            <% elsif incident.status == "open" %>
                <span class="tag is-danger">Open</span>
            <% end %>
          </td>
          <td><%= incident.created_at %></td>
          <td><%= incident.user %></td>
          <td><%= incident.tag_list %></td>
          <td><%= incident.tickets.count %></td>
          <td><%= incident.leads.count %></td>
          <td><%= link_to 'Show', incident %></td>
          <td><%= link_to 'Tree', tree_incident_path(incident) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<script>
  $(document).ready(function() {
    $(".incidents-table").DataTable({
      "pagingType": "simple_numbers",
      "language": { search: "" }
    });

        // style datatable search inputs
    $(".dataTables_filter input").addClass("input");
    $(".dataTables_filter input").attr("placeholder", "Search");
  });
</script>
